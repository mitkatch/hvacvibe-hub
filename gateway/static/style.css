/* ============================================================
   HVAC-Vibe  —  SCADA Industrial Dark Theme
   Screen: 480×320 landscape rendered via CSS rotation
   The Pi framebuffer is 320×480 portrait, so Chromium renders
   at 320×480 and we rotate/translate the body to fill landscape.
   ============================================================ */

/* ---- Reset ---- */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

/* ---- Base layout: 480x320 landscape (desktop default) ---- */
html {
  background: #12161c;
}

body {
  width:  480px;
  height: 320px;
  overflow: hidden;
  position: relative;
  font-family: 'Courier New', Courier, monospace;
  font-size: 11px;
  color: #dce1e6;
  background: #12161c;
  user-select: none;
  -webkit-user-select: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* ---- Kiosk mode: rotate for Pi 320x480 portrait framebuffer ----
   JS adds class="kiosk" to html+body when ?kiosk URL param present
   ---------------------------------------------------------------- */
html.kiosk {
  width:  320px;
  height: 480px;
  overflow: hidden;
}

body.kiosk {
  position: fixed;
  top: 0; left: 0;
  transform-origin: top left;
  transform: rotate(-90deg) translateX(-480px);
  cursor: none;
}

/* ---- Palette variables ---- */
:root {
  --bg:        #12161c;
  --panel:     #1c2230;
  --edge:      #2d3748;
  --accent:    #00a0dc;
  --green:     #00c864;
  --yellow:    #ffbe00;
  --red:       #dc3232;
  --white:     #dce1e6;
  --grey:      #64707d;
  --divider:   #28323e;
  --chart-ln:  #00b4ff;
  --chart-fill:#004882;
  --chart-grid:#232f3a;
  --now-line:  #ffdc3c;
}

/* ============================================================
   VIEWS
   ============================================================ */
.view        { position: absolute; inset: 0; width: 480px; height: 320px; display: none; flex-direction: column; }
.view.active { display: flex; }

/* ============================================================
   HEADER  (36px)
   ============================================================ */
header {
  display: flex;
  align-items: center;
  height: 36px;
  background: var(--panel);
  border-bottom: 1px solid var(--accent);
  padding: 0 6px;
  gap: 5px;
  flex-shrink: 0;
}

.app-title   { color: var(--accent); font-weight: bold; font-size: 13px; margin-right: 4px; }
.sensor-name { color: var(--white);  font-weight: bold; font-size: 13px; }
.setup-title { color: var(--grey);   font-size: 12px; }

.conn-dot {
  width: 9px; height: 9px; border-radius: 50%;
  border: 1px solid var(--edge); flex-shrink: 0;
}
.conn-dot.connected    { background: var(--green); }
.conn-dot.disconnected { background: var(--red); }

.conn-label { font-size: 10px; color: var(--grey); }

/* Signal bars */
.signal-bars { display: flex; align-items: flex-end; gap: 2px; height: 14px; }
.signal-bars .bar {
  width: 5px; border-radius: 1px;
  background: var(--divider);
}
.signal-bars .b1 { height:  4px; }
.signal-bars .b2 { height:  7px; }
.signal-bars .b3 { height: 10px; }
.signal-bars .b4 { height: 14px; }
.signal-bars .bar.on { background: var(--accent); }

.rssi-val { font-size: 10px; color: var(--grey); }

/* Battery */
.battery {
  position: relative; display: inline-flex;
  width: 36px; height: 14px; flex-shrink: 0;
  border: 1px solid var(--edge); border-radius: 2px;
}
.bat-fill {
  height: 100%; border-radius: 1px;
  background: var(--green); transition: width .3s;
}
.bat-tip {
  position: absolute; right: -4px; top: 3px;
  width: 3px; height: 6px;
  background: var(--edge); border-radius: 1px;
}
.bat-pct { font-size: 10px; color: var(--grey); }

/* Alarm badge */
.alarm-badge {
  margin-left: auto;
  background: var(--red); color: #000;
  font-weight: bold; font-size: 10px;
  padding: 2px 5px; border-radius: 3px;
}
.alarm-badge.hidden { display: none; }

.clock { margin-left: auto; font-size: 10px; color: var(--grey); margin-right: 4px; }

.btn-gear {
  background: none;
  border: 1px solid var(--edge);
  border-radius: 3px;
  color: var(--grey);
  font-size: 14px;
  width: 24px; height: 24px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  transition: color .15s, border-color .15s;
}
.btn-gear:hover { color: var(--accent); border-color: var(--accent); }

/* ← Main button in setup header */
.btn-main-link {
  margin-left: auto;
  background: var(--panel); color: var(--white); border: 1px solid var(--edge);
  font-family: inherit; font-size: 10px;
  padding: 3px 8px; border-radius: 3px; cursor: pointer;
}

/* ============================================================
   TILES  (60px)
   ============================================================ */
.tiles {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 2px;
  padding: 3px 1px;
  height: 63px;
  flex-shrink: 0;
}

.tile {
  background: var(--panel);
  border: 1px solid var(--edge);
  border-radius: 4px;
  padding: 4px 6px;
  display: flex; flex-direction: column;
}

.tile-label {
  font-size: 10px; color: var(--grey);
  margin-bottom: 2px;
}

.tile-value {
  font-size: 15px; font-weight: bold; color: var(--accent);
  display: flex; align-items: baseline; gap: 2px;
}

.tile-unit  { font-size: 10px; color: var(--grey); font-weight: normal; }

#tile-rms  .tile-value { color: var(--accent); }
#tile-peak .tile-value { color: var(--yellow); }
#tile-temp .tile-value { color: var(--yellow); }
#tile-hum  .tile-value { color: var(--accent); }
.alarm #tile-rms .tile-value { color: var(--red); }

/* ============================================================
   CHART AREA
   ============================================================ */
.chart-area {
  flex: 1;
  display: flex;
  min-height: 0;
  height: calc(320px - 36px - 63px - 10px);  /* H - header - tiles - gaps */
  padding: 0 2px 2px 0;
}

.chart-yaxis {
  width: 32px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 20px 2px 18px 2px;
  font-size: 10px; color: var(--grey);
  text-align: right;
  flex-shrink: 0;
}

.chart-yaxis span { display: block; }

.chart-wrap {
  flex: 1;
  position: relative;
  background: var(--panel);
  border: 1px solid var(--edge);
  border-radius: 4px;
  overflow: hidden;
  min-width: 0;
  min-height: 0;
  height: 100%;
}

#chart-canvas {
  position: absolute; inset: 0;
  width: 100%; height: 100%;
}

/* ============================================================
   SETUP  —  Tab bar
   ============================================================ */
.tab-bar {
  display: flex;
  height: 30px;
  background: var(--panel);
  border-bottom: 1px solid var(--accent);
  flex-shrink: 0;
}

.tab {
  flex: 1;
  background: none; color: var(--grey);
  border: none; border-right: 1px solid var(--edge);
  font-family: inherit; font-size: 12px; font-weight: bold;
  cursor: pointer;
  transition: background .15s;
}
.tab:last-child { border-right: none; }
.tab.active { background: var(--accent); color: #000; }

/* ---- Tab content panels ---- */
.tab-content { display: none; flex-direction: column; flex: 1; min-height: 0; }
.tab-content.active { display: flex; }

/* ---- List panel (WiFi / BLE) ---- */
.list-panel {
  flex: 1; overflow-y: auto; overflow-x: hidden;
  background: var(--panel);
  border: 1px solid var(--edge); border-radius: 4px;
  margin: 4px 4px 0 4px;
}

.list-empty {
  padding: 20px; text-align: center; color: var(--grey); font-size: 11px;
}

/* WiFi row */
.wifi-row {
  display: flex; align-items: center;
  height: 28px; padding: 0 8px;
  border-bottom: 1px solid var(--divider);
  cursor: pointer;
  gap: 6px;
}
.wifi-row:hover, .wifi-row.selected { background: #003c64; }
.wifi-row .w-ssid   { flex: 1; font-size: 12px; color: var(--white); overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.wifi-row .w-ssid.connected { color: var(--green); }
.wifi-row .w-check  { color: var(--green); font-size: 12px; }
.wifi-row .w-lock   { font-size: 11px; }
.wifi-row .w-bars   { display: flex; align-items: flex-end; gap: 2px; height: 12px; }
.wifi-row .w-bars span { width: 4px; border-radius: 1px; background: var(--divider); }
.wifi-row .w-bars span.on { background: var(--accent); }
.w-bars .wb1 { height: 3px; }
.w-bars .wb2 { height: 6px; }
.w-bars .wb3 { height: 9px; }
.w-bars .wb4 { height: 12px; }

/* BLE row */
.ble-row {
  display: flex; align-items: center;
  min-height: 36px; padding: 4px 8px;
  border-bottom: 1px solid var(--divider);
  gap: 6px;
}
.ble-row.paired { background: #0a280a; }
.ble-row .b-info { flex: 1; min-width: 0; }
.ble-row .b-name { font-size: 12px; font-weight: bold; color: var(--white); }
.ble-row.paired .b-name { color: var(--green); }
.ble-row .b-addr { font-size: 10px; color: var(--grey); }
.ble-row .b-rssi { font-size: 10px; color: var(--grey); }
.ble-row .btn-pair   { background: var(--accent); color: #000; border: none; border-radius: 3px; padding: 3px 8px; font-family: inherit; font-size: 10px; font-weight: bold; cursor: pointer; flex-shrink: 0; }
.ble-row .btn-unpair { background: var(--red);    color: #fff; border: none; border-radius: 3px; padding: 3px 8px; font-family: inherit; font-size: 10px; font-weight: bold; cursor: pointer; flex-shrink: 0; }

/* Tab footer */
.tab-footer {
  display: flex; align-items: center;
  height: 32px; padding: 0 6px;
  border-top: 1px solid var(--divider);
  gap: 6px;
  flex-shrink: 0;
}
.status-msg  { flex: 1; font-size: 10px; color: var(--grey); }
.status-msg.ok  { color: var(--green); }
.status-msg.err { color: var(--red); }
.status-msg.warn { color: var(--yellow); }
.btn-action {
  background: var(--accent); color: #000;
  border: none; border-radius: 3px;
  padding: 4px 14px; font-family: inherit; font-size: 11px; font-weight: bold;
  cursor: pointer; flex-shrink: 0;
}

/* ---- Status tab ---- */
.status-section { padding: 8px 10px 6px; }
.status-heading { font-size: 12px; font-weight: bold; color: var(--accent); margin-bottom: 6px; }
.status-row     { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
.status-dot     { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.status-dot.green { background: var(--green); }
.status-dot.red   { background: var(--red); }
.status-dot.grey  { background: var(--grey); }
.status-text    { font-size: 12px; color: var(--white); }
.status-sub     { font-size: 10px; color: var(--grey); margin-left: 18px; }
.status-divider { height: 1px; background: var(--divider); margin: 0 8px; }

/* ============================================================
   KEYBOARD OVERLAY
   ============================================================ */
.keyboard-overlay {
  position: fixed; inset: 0; z-index: 100;
  background: rgba(0,0,0,.75);
  display: flex; flex-direction: column;
  padding: 4px;
}
.keyboard-overlay.hidden { display: none; }

.kbd-prompt {
  font-size: 11px; color: var(--accent);
  padding: 4px 6px 2px;
}

.kbd-field {
  background: var(--panel);
  border: 1px solid var(--accent);
  border-radius: 3px;
  padding: 4px 8px;
  font-size: 14px; font-weight: bold;
  color: var(--white);
  height: 28px;
  overflow: hidden;
  white-space: nowrap;
  margin-bottom: 4px;
}
.kbd-cursor { animation: blink .8s step-end infinite; }
@keyframes blink { 50% { opacity: 0; } }

.keyboard {
  flex: 1;
  display: flex; flex-direction: column;
  gap: 3px;
}

.kbd-row {
  display: flex; gap: 3px; justify-content: center;
}

.kbd-key {
  background: var(--panel);
  border: 1px solid var(--edge);
  border-radius: 3px;
  color: var(--white);
  font-family: inherit; font-size: 11px;
  height: 26px; min-width: 26px; padding: 0 4px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  -webkit-tap-highlight-color: transparent;
}
.kbd-key:active      { background: var(--accent); color: #000; }
.kbd-key.special     { background: var(--divider); min-width: 36px; }
.kbd-key.key-space   { flex: 1; max-width: 100px; }
.kbd-key.key-ok      { background: var(--green); color: #000; font-weight: bold; min-width: 44px; }
.kbd-key.key-ok:active { background: #00ff80; }
